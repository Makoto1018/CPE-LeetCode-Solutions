## Problem Title

- **Problem Number**:  1934. Confirmation Rate
- **Difficulty**: Medium
- **Link**: [LeetCode 問題連結](https://leetcode.com/problems/confirmation-rate/description/?envType=study-plan-v2&envId=top-sql-50)
- **是否有先參考別人的觀念**: 有看hint
---

### Problem Description

The confirmation rate of a user is the number of 'confirmed' messages divided by the total number of requested confirmation messages. The confirmation rate of a user that did not request any confirmation messages is 0. Round the confirmation rate to two decimal places.

Write a solution to find the confirmation rate of each user.

Return the result table in any order.
---

### Approach

1. **思路概述**：先知道怎麼計算出 RATE 再回去處理 JOIN
2. **關鍵步驟**：
   - 使用 `RIGHT JOIN` 保證所有 Signups 使用者都會出現，即使沒發送過確認訊息
   - 用 `CASE WHEN` 統計 confirmed 次數
   - 用 `COUNT(*)` 統計所有請求數
   - 使用 `ROUND(..., 2)` 四捨五入到小數點兩位
3. **時間複雜度分析**：$O(n)$

---

### Other Solution

> 其他的解法

---
### Summary

- **學到的新觀念**:
1. SUM()括號裡面的運作方式，要記得使用CASE WHEN (條件) THEN 1 ELSE 0 END
- **遇到的困難點與解法**:

---

### code
```sql
SELECT s.user_id, ROUND( (SUM(CASE WHEN action='confirmed' THEN 1 ELSE 0 END) *1.0 / COUNT(*))::numeric, 2) as confirmation_rate
FROM Confirmations as c
RIGHT JOIN Signups AS s
ON c.user_id = s.user_id
GROUP BY s.user_id;
```