## Problem Title

- **Problem Number**:  1251. Average Selling Price
- **Difficulty**: easy
- **Link**: [LeetCode 問題連結](https://leetcode.com/problems/average-selling-price/description/?envType=study-plan-v2&envId=top-sql-50)
- **是否有先參考別人的觀念**: 有
---

### Problem Description

Write a solution to find the average selling price for each product. average_price should be rounded to 2 decimal places. If a product does not have any sold units, its average selling price is assumed to be 0.

Return the result table in any order.
---

### Approach

1. **思路概述**：如果要處理 NULL 的話可以用 COALESCE() ，他會回傳第一個非NULL的值。
2. **關鍵步驟**：
   - 用 `p.product_id = u.product_id` 、 `p.start_date <= u.purchase_date` 、 `u.purchase_date <= p.end_date` 來挑選join的方式
   - 用 `p.product_id` 分組，一樣要去想像一下分組之後的表格會長甚麼樣子
   - 最後用 `COALESCE((ROUND(SUM(price * units) / SUM(units)::numeric, 2)),0)` 來去處理NULL
3. **時間複雜度分析**：$O(n)$

---

### Other Solution

> 其他的解法

---
### Summary

- **學到的新觀念**:
1. COALESCE() 的用法，會回傳參數中第一個非NULL的值
- **遇到的困難點與解法**:
1. 處理null
2. 怎麼GROUP
---

### code
```sql
SELECT p.product_id,  COALESCE((ROUND(SUM(price * units) / SUM(units)::numeric, 2)),0)  as average_price
FROM Prices as p
LEFT JOIN UnitsSold as u
ON p.product_id = u.product_id AND p.start_date <= u.purchase_date and u.purchase_date <= p.end_date
GROUP BY p.product_id;
```