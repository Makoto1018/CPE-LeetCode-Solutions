## Problem Title

- **Problem Number**:  550. Game Play Analysis IV
- **Difficulty**: medium
- **Link**: [LeetCode 問題連結](https://leetcode.com/problems/game-play-analysis-iv/description/?envType=study-plan-v2&envId=top-sql-50)
- **是否有先參考別人的觀念**:
1. 有，去看了怎麼取出第一筆資料
---

### Problem Description

Write a solution to report the fraction of players that logged in again on the day after the day they first logged in, rounded to 2 decimal places. In other words, you need to count the number of players that logged in for at least two consecutive days starting from their first login date, then divide that number by the total number of players.
---

### Approach

1. **思路概述**： 先找出第一天之後，看有沒有第二天登入就是第一天隔天的

2. **關鍵步驟**：
    - 使用 `count(distinct a2.player_id)` 可以算出總共有多少個不重複的玩家
    - 使用 `SELECT player_id, min(event_date) as min_date FROM Activity GROUP BY player_id` 挑出每個玩家的首次登入日
    - `join Activity as a2 on ...` 為了找出第二天是否就是首登日隔天所以join自己
    - `count(CASE WHEN a1.min_date + 1 = a2.event_date THEN 1 ELSE NULL END` 找出隔天
3. **時間複雜度分析**：$O(n^2)$ 可能會到n平方

---

### Other Solution

> 其他的解法

---
### Summary

- **學到的新觀念**:
- **遇到的困難點與解法**:
---

### code

1. 自己寫的

```sql
SELECT ROUND(count(CASE WHEN a1.min_date + 1 = a2.event_date THEN 1 ELSE NULL END)*1.0/count(distinct a2.player_id)::NUMERIC ,2) as fraction
FROM (SELECT player_id, min(event_date) as min_date FROM Activity GROUP BY player_id) as a1
JOIN Activity a2
ON a1.player_id = a2.player_id;
```

2. 別人寫的

```sql
-- Write your PostgreSQL query statement below
SELECT 
    ROUND(COUNT(player_id) * 1. / (
        SELECT COUNT(DISTINCT player_id)
        FROM Activity
    ), 2) AS fraction
FROM Activity
WHERE (player_id, event_date) IN (
    SELECT player_id, MIN(event_date) + 1 AS first_log
    FROM Activity
    GROUP BY player_id
)
```