## Problem Title

- **Problem Number**:  1070. Product Sales Analysis III
- **Difficulty**: medium
- **Link**: [LeetCode 問題連結](https://leetcode.com/problems/product-sales-analysis-iii/description/?envType=study-plan-v2&envId=top-sql-50)
- **是否有先參考別人的觀念**:
1. 無
---

### Problem Description

Write a solution to select the product id, year, quantity, and price for the first year of every product sold.

Return the resulting table in any order.
---

### Approach

1. **思路概述**：找出最早的一年印出來就好
2. **關鍵步驟**：
    - `WHERE (product_id, year) in` 的使用
3. **時間複雜度分析**：$O(n)$

---

### Other Solution

> 其他的解法

---
### Summary

- **學到的新觀念**:
1. rank() 跟 number() 的不同
  - ROW_NUMBER() 只會選出一筆資料（會錯過同年的其他筆數）
  - RANK() 會給同一組排名一樣的 row 相同的 rank，可保留所有第一年的記錄
- **遇到的困難點與解法**:

---

### code
1. 自己寫的
```sql
SELECT product_id, year as first_year, quantity, price
FROM Sales as s
WHERE (product_id, year) in
    (SELECT product_id, min(year)
     FROM Sales
     GROUP BY product_id
);
```
2. 用 rank() ，不用 row_number() 是因為他只會留下第一筆資料，用rank的話就會把所有的第一年設為 rn=1
```sql
WITH ranked_sales AS (
  SELECT *, 
         rank() OVER (PARTITION BY product_id ORDER BY year asc) AS rn
  FROM Sales
)
SELECT product_id, year AS first_year, quantity, price
FROM ranked_sales
WHERE rn = 1;
```