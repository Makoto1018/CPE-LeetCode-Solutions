## Problem Title

- **Problem Number**:  1321. Restaurant Growth
- **Difficulty**: Medium
- **Link**: [LeetCode 問題連結](https://leetcode.com/problems/restaurant-growth/description/?envType=study-plan-v2&envId=top-sql-50)
- **是否有先參考別人的觀念**: 有
1. `on d2.visited_on BETWEEN d1.visited_on - 6 AND d1.visited_on`
---

### Problem Description

You are the restaurant owner and you want to analyze a possible expansion (there will be at least one customer every day).

Compute the moving average of how much the customer paid in a seven days window (i.e., current day + 6 days before). average_amount should be rounded to two decimal places.

Return the result table ordered by visited_on in ascending order.

---

### Approach

1. **思路概述**：先把重複的那幾天加總起來變回只剩下一天，然後再把能往前算七天的資料找出來，算得答案
2. **關鍵步驟**：
3. **時間複雜度分析**：$O(n)$

---

### Other Solution


---
### Summary

- **學到的新觀念**: 
1. `on d2.visited_on BETWEEN d1.visited_on - 6 AND d1.visited_on` 可以找出前面七天的資料
2. `HAVING count(d2.total)=7` 挑出剛好七天的資料
- **遇到的困難點與解法**:

---

### code
```sql
WITH d as(SELECT visited_on, sum(amount) as total
 FROM Customer
 GROUP BY visited_on
)

SELECT d1.visited_on, sum(d2.total) as amount, round(sum(d2.total)/7::numeric,2) as average_amount
FROM d d1
JOIN d d2
on d2.visited_on BETWEEN d1.visited_on - 6 AND d1.visited_on
GROUP BY d1.visited_on
HAVING count(d2.total)=7
ORDER BY d1.visited_on asc;
```